let output = {|{
  "/key/.version": "CVn4OTHFgCGiM5BEaitk6Q0gxjhD+OvTFdpaaAU=",
  "/domain-key/0":
    "dfdIH9N6KZSRyzgH9/m6YKrKnPJjc6XNTCN9JiARNijApM/vwqolM5G512L+PVM8N8TcPsd2AH8Bl6u5kSTLaKr0iQD5p+KE1ve/HrG8eTtzG3VfQfHxmbEgWyw=",
  "/config/version": "MA==",
  "/config/unlock-salt": "wJ1WGdcsKOwR4tFFzXafXA==",
  "/config/time-offset": "LTQwMTkyMDQ1",
  "/config/private-key":
    "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUNkd0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQW1Fd2dnSmRBZ0VBQW9HQkFMWEl0dnJUSy9PZDgxU08KY2lHTFJMOFhxa2IrM0x0S1BPKzdobFpHM2J3RlBuSXNuaHRmQkZuMWswWDM2NzRHTjNHY3pFYUdUaGlhY0dOQgphZU05YlpSNEthWCsvNWhhTnUxbkkwakFaVFQ2eTZUSEpacmhxRFlqR2tEZjlIb2hBSXl5LzdEZjN6NjY1anpVCkYzcno3TTZiejd5RnVjQ3poK2FGMmQrSEhaWDNBZ01CQUFFQ2dZRUFsUExBVTJjaVZUd3Z2REgzZkZyRDJwd0cKYnFPM3MxS1IrWkM2OHdpZitNYUhNMEF4MEpXYldDYXJKS0tPckNZbDJkYXpYbm4vbFpNOTBXWXczL3hlUXUzeQp0NDg1V0EyTjdtYXAxMUozSFViMElyTi84bGE3ampMQzlrbVpmM2dQREEwR0ZGTXRnSTY2dE5HS3JEM1NFQUtWCnJhQzd3d0Nsc0ZlUm1ES3dzV2tDUVFEakQ1QjN4aHY1TTc2VnFocDdjeXVNSG9nbm1oY09WWDdEL3JjWU51ZGwKQmt4bERVWUQ2cUliRTIwbXBBTkZVRDJpZVdjTHA4UTRULzJob1FJREtPVERBa0VBelBQaGxYY0pDemNVZi9YdQpqKzduN0N4OXh5NmVyVENiUXcwWkI5UWJvblNsaldkdkt1bWYyY1lReXdqZkUvZlBDVnRkL25zRlh0TmtGbEozCmhhMW12UUpBYVU2ZnB4MG5maVZrZjg4N3B3T2NMOGs5Um5pdHRzVXFITVoycm5GUVVrZGdpUUZsOW8wTWo5Z3IKcUY4cThTdXMyanpKOE5ybkkyTGQ4K2RUb3BtRnR3SkFid2Z3UGJpdS9aUnBWcWsxQkdTNDRBbDZXbDIzT0x3TQpZTmJIcUtZUUVvSis3WXdMZllQelJWYzM0Y1o4azZTOFZLVmExbkp2Qm1BZTZMamtaMWI1UVFKQkFMOWFBTVV4CnVGbTFsc2RzVnFXY0VoZ0R3Nzdoak9MWE9wc1F5QWowYWVsMFd1ZDBDYkpCWGd5dTdzdk5IekRNeUNNd3lZWksKUnprYUVaTzFtSWxjTFowPQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==",
  "/config/certificate":
    "AAABrjCCAaowggEToAMCAQICCQCHftzZMvxvHjANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDDAlrZXlmZW5kZXIwJBcNNzAwMTAxMDAwMDAwWhgTOTk5OTEyMzEyMzU5NTkuOTk5WjAUMRIwEAYDVQQDDAlrZXlmZW5kZXIwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBALXItvrTK/Od81SOciGLRL8Xqkb+3LtKPO+7hlZG3bwFPnIsnhtfBFn1k0X3674GN3GczEaGThiacGNBaeM9bZR4KaX+/5haNu1nI0jAZTT6y6THJZrhqDYjGkDf9HohAIyy/7Df3z665jzUF3rz7M6bz7yFucCzh+aF2d+HHZX3AgMBAAEwDQYJKoZIhvcNAQELBQADgYEApsJ5UZnp9L50E8O9WJh5rNMEWRiyEXvf0dZANorCIriIz+QuSKNLOcyxxqTYl9dBu6+Zf9/TpOTv8anf4PszPPY/fFPtQvlBqN7lEXi/GCXfx8alBMPT+CtMWWkaLh2uqnyl3Et4PvcQ9jQopNNGcAu2uIv7fx1XQ7fUPwCdGnE=",
  "/config/backup-salt": "WnFUpfK/BFP6sBCyMxUQzg==",
  "/config/backup-key": "aCckwOHBwVZdoubMisZkoegQe3LIJd3f6OzzzyeWbs4=",
  "/authentication/ea2fcb83c49f854535ac":
    "xqH/XNfGj+4hY2fEa+KKSk3Gz+tr/nKPvhc4PJ5fvDyI7ry36vdRgPihcC47i1A6SDNeLB+Z4GCqCAe7CZfSxQ91xgMfONKxE4WFE5FQJi7mAgyyuqYNdi9DvFDSv2FBIY1dsaF2uOE8itpXLAkhStdeAWXQCsqa1+K1WEvKLBRMAjyC9bMKo1GZ",
  "/authentication/admin":
    "MTkd0Q/4fsNyP9wOz/+ZOUbFrgZkp+XT/XvchXKtWIiLvZnTxc99jmLRyld8kpdaecng1xZL8qqqVvlRIxBK2MRv6r9YCWbaBwOgKJ3ofLzAMcCmQrm+BtbSoUqoAOKQ2VRD4y42l0ou1Wv6Qi4oFkUDL5cQe1GTU9Em/yYZFIrFW7hKdu5bYaZkz3fN8kzhGNJ90sd1weWkHXuC2TeAnf6nJ9A=",
  "/authentication/.version": "1Qc1dIjSZrWgjfemqP+6LRBnl3b92HDAFij2+Uc="
}|}

let readfile filename =
  let fd = Unix.openfile filename [Unix.O_RDONLY] 0 in
  let filesize = (Unix.stat filename).Unix.st_size in
  let buf = Bytes.create filesize in
  let rec read off =
    if off = filesize
    then ()
    else
      let bytes_read = Unix.read fd buf off (filesize - off) in
      read (bytes_read + off)
  in
  read 0;
  Unix.close fd;
  Bytes.to_string buf

let () =
  let returncode = Sys.command "../bin/export_backup.exe backup_passphrase my_backup.bin --output=my_backup.json" in
  assert (returncode = 0);
  let body = readfile "my_backup.json" in
  assert (String.equal output body)

