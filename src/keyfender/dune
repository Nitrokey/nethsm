(* -*- tuareg -*- *)

let bisect = try Sys.getenv "BISECT_ENABLE" = "yes" with _ -> false

let () =
  Jbuild_plugin.V1.send @@ Printf.sprintf {|
(library
  (name        keyfender)
  (public_name keyfender)
  (preprocess (pps ppx_deriving_yojson ppx_deriving.std %s))
  (libraries astring logs lwt ptime cohttp rresult mirage-crypto mirage-crypto-pk webmachine cohttp-lwt yojson mirage-clock mirage-random pbkdf mirage-kv tls x509 hex gmap ipaddr metrics mirage-time duration))
  |}
 (if bisect then "bisect_ppx -conditional" else "")
